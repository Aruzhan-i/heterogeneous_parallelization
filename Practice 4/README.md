<a id="toc"></a>
# –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
- [–ó–∞–¥–∞–Ω–∏–µ 1](#task1)
  - [–ë–ª–æ–∫ —Å—Ö–µ–º–∞](#task1-schema)
  - [–í—ã–≤–æ–¥ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞](#task1-output)
- [–ó–∞–¥–∞–Ω–∏–µ 2](#task2)
  - [–ë–ª–æ–∫ —Å—Ö–µ–º–∞](#task2-schema)
  - [–í—ã–≤–æ–¥ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞](#task2-output)
- [–ó–∞–¥–∞–Ω–∏–µ 3](#task3)
  - [–ë–ª–æ–∫ —Å—Ö–µ–º–∞](#task3-schema)
  - [–í—ã–≤–æ–¥ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞](#task3-output)
- [–ó–∞–¥–∞–Ω–∏–µ 4](#task4)
  - [–ë–ª–æ–∫ —Å—Ö–µ–º–∞](#task4-schema)
  - [–í—ã–≤–æ–¥ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞](#task4-output)
  - [–ì—Ä–∞—Ñ–∏–∫–∏](#task4-charts)
- [–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã] (#control-questions)


<a id="task1"></a>
# –ó–∞–¥–∞–Ω–∏–µ 1


–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–∞—Å—Å–∏–≤–∞ —Å–ª—É—á–∞–π–Ω—ã—Ö —á–∏—Å–µ–ª
(—Ä–∞–∑–º–µ—Ä: 1,000,000 —ç–ª–µ–º–µ–Ω—Ç–æ–≤).

<a id="task1-schema"></a>
## –ë–ª–æ–∫ —Å—Ö–µ–º–∞
![alt text](task_1_block_schema.svg)

<a id="task1-output"></a>
## –í—ã–≤–æ–¥ –¢–µ—Ä–º–∏–Ω–∞–ª–∞
![alt text](task_1_terminal_output.png)

–î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –Ω–∞ C++, —Å–æ–∑–¥–∞—é—â–∞—è –º–∞—Å—Å–∏–≤ –∏–∑ —Å–ª—É—á–∞–π–Ω—ã—Ö —á–∏—Å–µ–ª —Å —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω—ã–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º.
–†–∞–∑–º–µ—Ä –º–∞—Å—Å–∏–≤–∞ –∑–∞–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏.
–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ CUDA-–ø—Ä–æ–≥—Ä–∞–º–º–∞—Ö —Ä–µ–¥—É–∫—Ü–∏–∏ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏.

<a id="task2"></a>
# –ó–∞–¥–∞–Ω–∏–µ 2

–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ —Ä–µ–¥—É–∫—Ü–∏–æ–Ω–Ω–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞:‚óè –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–µ–¥—É–∫—Ü–∏—é —Å—É–º–º—ã —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –º–∞—Å—Å–∏–≤–∞ —Å
–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º:
a. –¢–æ–ª—å–∫–æ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –ø–∞–º—è—Ç–∏.
b. –ö–æ–º–±–∏–Ω–∞—Ü–∏–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –∏ —Ä–∞–∑–¥–µ–ª—è–µ–º–æ–π –ø–∞–º—è—Ç–∏.

–°—Ä–∞–≤–Ω–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –æ–±—ä—è—Å–Ω–∏—Ç—å –≤–ª–∏—è–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
—Ä–∞–∑–¥–µ–ª—è–µ–º–æ–π –ø–∞–º—è—Ç–∏.
<a id="task2-schema"></a>
## –ë–ª–æ–∫ —Å—Ö–µ–º–∞
![alt text](task_2_block_schema.svg)

<a id="task2-output"></a>
## –í—ã–≤–æ–¥ –¢–µ—Ä–º–∏–Ω–∞–ª–∞
![alt text](task_2_terminal_output.png)

<a id="task3"></a>
# –ó–∞–¥–∞–Ω–∏–µ 3

–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –Ω–∞ GPU:
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É –ø—É–∑—ã—Ä—å–∫–æ–º –¥–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö –ø–æ–¥–º–∞—Å—Å–∏–≤–æ–≤ —Å
–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–π –ø–∞–º—è—Ç–∏.
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–∞–º—è—Ç—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–±—â–µ–≥–æ –º–∞—Å—Å–∏–≤–∞.
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–ª–∏—è–Ω–∏–µ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–¥–º–∞—Å—Å–∏–≤–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
—Ä–∞–∑–¥–µ–ª—è–µ–º–æ–π –ø–∞–º—è—Ç–∏


<a id="task3-schema"></a>
## –ë–ª–æ–∫ —Å—Ö–µ–º–∞
![alt text](task_3_block_schema.svg)

<a id="task3-output"></a>
## –í—ã–≤–æ–¥ –¢–µ—Ä–º–∏–Ω–∞–ª–∞
![alt text](task_3_terminal_output.png)



<a id="task4"></a>
# –ó–∞–¥–∞–Ω–∏–µ 4
–ò–∑–º–µ—Ä–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:
- –ó–∞–º–µ—Ä–∏—Ç—å –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤
–ø–∞–º—è—Ç–∏ –¥–ª—è –º–∞—Å—Å–∏–≤–æ–≤ —Ä–∞–∑–º–µ—Ä–æ–º 10,000, 100,000 –∏ 1,000,000 —ç–ª–µ–º–µ–Ω—Ç–æ–≤.
- –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Ç —Ä–∞–∑–º–µ—Ä–∞
–º–∞—Å—Å–∏–≤–∞.
<a id="task4-schema"></a>
## –ë–ª–æ–∫ —Å—Ö–µ–º–∞
![alt text](task_4_block_schema.svg)

<a id="task4-output"></a>
## –í—ã–≤–æ–¥ –¢–µ—Ä–º–∏–Ω–∞–ª–∞
![alt text](task_4_terminal_output.png)

<a id="task4-charts"></a>
## –ì—Ä–∞—Ñ–∏–∫–∏
![alt text](results/sort_times.svg)
![alt text](results/reduce_times.svg)


<a id="control-questions"></a>
# –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã


# 1. –ß–µ–º –æ—Ç–ª–∏—á–∞—é—Ç—Å—è —Ç–∏–ø—ã –ø–∞–º—è—Ç–∏ –≤ CUDA –∏ –∫–æ–≥–¥–∞ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?

–í CUDA –µ—Å—Ç—å **–∏–µ—Ä–∞—Ä—Ö–∏—è –ø–∞–º—è—Ç–∏** ‚Äî —á–µ–º –ø–∞–º—è—Ç—å –±–ª–∏–∂–µ –∫ –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω–æ–º—É —è–¥—Ä—É, —Ç–µ–º –æ–Ω–∞ **–±—ã—Å—Ç—Ä–µ–µ**, –Ω–æ **–º–µ–Ω—å—à–µ –ø–æ –æ–±—ä—ë–º—É**.

| –¢–∏–ø –ø–∞–º—è—Ç–∏    | –ì–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è                    | –°–∫–æ—Ä–æ—Å—Ç—å           | –û–±—ä—ë–º          | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å                 |
| ------------- | -------------------------------- | ------------------ | -------------- | ---------------------------------- |
| **Registers** | –≤–Ω—É—Ç—Ä–∏ –ø–æ—Ç–æ–∫–∞                    | üî• —Å–∞–º–∞—è –±—ã—Å—Ç—Ä–∞—è   | –æ—á–µ–Ω—å –º–∞–ª–æ     | –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ               |
| **Local**     | –≤ –ø–∞–º—è—Ç–∏ –ø–æ—Ç–æ–∫–∞ (—á–∞—Å—Ç–æ –≤ global) | –º–µ–¥–ª–µ–Ω–Ω–∞—è          | —Å—Ä–µ–¥–Ω–∏–π        | –∫–æ–≥–¥–∞ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤         |
| **Shared**    | –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞                     | üöÄ –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–∞—è   | ~48 KB –Ω–∞ –±–ª–æ–∫ | –æ–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏ –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏ –±–ª–æ–∫–∞ |
| **Global**    | –ø–∞–º—è—Ç—å GPU                       | üê¢ –º–µ–¥–ª–µ–Ω–Ω–∞—è       | GB             | –±–æ–ª—å—à–∏–µ –º–∞—Å—Å–∏–≤—ã                    |
| **Constant**  | –∫–µ—à–∏—Ä—É–µ–º–∞—è                       | –±—ã—Å—Ç—Ä–∞—è –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ | 64 KB          | –Ω–µ–∏–∑–º–µ–Ω—è–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã             |
| **Texture**   | –∫–µ—à–∏—Ä—É–µ–º–∞—è                       | –±—ã—Å—Ç—Ä–∞—è –¥–ª—è 2D/3D  | –∑–∞–≤–∏—Å–∏—Ç        | –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, —Ñ–∏–ª—å—Ç—Ä—ã               |

### üîπ –ü—Ä–∏–º–µ—Ä

–í —Ä–µ–¥—É–∫—Ü–∏–∏ —Å—É–º–º—ã:

* **Global memory** ‚Äî —Ö—Ä–∞–Ω–∏–º –≤–µ—Å—å –º–∞—Å—Å–∏–≤
* **Shared memory** ‚Äî —Å—É–º–º–∏—Ä—É–µ–º –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞
* **Registers** ‚Äî –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

```cpp
__global__ void reduce_shared(const float* a, float* out) {
    extern __shared__ float s[];
    int tid = threadIdx.x;
    s[tid] = a[blockIdx.x * blockDim.x + tid];
    __syncthreads();

    // —Ä–µ–¥—É–∫—Ü–∏—è –≤ shared
}
```

üëâ **–ü—Ä–∞–≤–∏–ª–æ**:

> –ß–µ–º —á–∞—â–µ –¥–∞–Ω–Ω—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è ‚Üí —Ç–µ–º –±–ª–∏–∂–µ –∫ —è–¥—Ä—É –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å.

---

# 2. –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ shared memory –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å?

Shared memory:

* –≤ **10‚Äì100 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ**, —á–µ–º global
* —É–º–µ–Ω—å—à–∞–µ—Ç —á–∏—Å–ª–æ –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ –º–µ–¥–ª–µ–Ω–Ω–æ–π –ø–∞–º—è—Ç–∏
* —Å–Ω–∏–∂–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –ø–∞–º—è—Ç—å –∏ —à–∏–Ω—É

### üîπ –ü—Ä–∏–º–µ—Ä: —Ä–µ–¥—É–∫—Ü–∏—è

**–ü–ª–æ—Ö–æ (global atomic)**
–ö–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ –¥–µ–ª–∞–µ—Ç `atomicAdd` –≤ global ‚Üí —Ç—ã—Å—è—á–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤.

**–•–æ—Ä–æ—à–æ (shared + atomic)**
–°–Ω–∞—á–∞–ª–∞ —Å—É–º–º–∏—Ä—É–µ–º –≤ shared, –ø–æ—Ç–æ–º **1 atomicAdd –Ω–∞ –±–ª–æ–∫**.

```cpp
if (tid == 0)
    atomicAdd(out, s[0]);
```

### üìä –†–µ–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç

| –í–∞—Ä–∏–∞–Ω—Ç         | –í—Ä–µ–º—è      |
| --------------- | ---------- |
| –¢–æ–ª—å–∫–æ global   | 4.2 ms     |
| Shared + global | **0.6 ms** |

üëâ –£—Å–∫–æ—Ä–µ–Ω–∏–µ **~7 —Ä–∞–∑** —Ç–æ–ª—å–∫–æ –∑–∞ —Å—á—ë—Ç –ø–∞–º—è—Ç–∏.

---

# 3. –ß—Ç–æ —Ç–∞–∫–æ–µ –∫–æ–∞–ª–µ—Å—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∏ –∫–∞–∫ –µ–≥–æ –æ–±–µ—Å–ø–µ—á–∏—Ç—å?

**–ö–æ–∞–ª–µ—Å—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø** ‚Äî –∫–æ–≥–¥–∞ –ø–æ—Ç–æ–∫–∏ —á–∏—Ç–∞—é—Ç –ø–∞–º—è—Ç—å **–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ**.

### ‚ùå –ü–ª–æ—Ö–æ

```cpp
int idx = threadIdx.x * 1024;
x = a[idx];     // –±–æ–ª—å—à–∏–µ —Å–∫–∞—á–∫–∏ –ø–æ –ø–∞–º—è—Ç–∏
```

### ‚úÖ –•–æ—Ä–æ—à–æ

```cpp
int idx = blockIdx.x * blockDim.x + threadIdx.x;
x = a[idx];     // –ø–æ–¥—Ä—è–¥
```

### –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ?

GPU —á–∏—Ç–∞–µ—Ç –ø–∞–º—è—Ç—å **–ø–∞—á–∫–∞–º–∏** (128 –±–∞–π—Ç).
–ï—Å–ª–∏ –ø–æ—Ç–æ–∫–∏ —á–∏—Ç–∞—é—Ç –ø–æ–¥—Ä—è–¥ ‚Üí **1 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è**.
–ï—Å–ª–∏ –≤—Ä–∞–∑–Ω–æ–±–æ–π ‚Üí **32 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**.

üëâ –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–º–µ–¥–ª–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É **–≤ –¥–µ—Å—è—Ç–∫–∏ —Ä–∞–∑**.

---

# 4. –ö–∞–∫–∏–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –±–æ–ª—å—à–∏–º–∏ –æ–±—ä—ë–º–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö?

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ GPU**

   * –ù–∞–ø—Ä–∏–º–µ—Ä: RTX 4050 = ~6 GB
   * –î–∞—Ç–∞—Å–µ—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å 20 GB ‚Üí –Ω–µ –ø–æ–º–µ—â–∞–µ—Ç—Å—è

2. **–î–æ–ª–≥–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ CPU ‚Üí GPU**

   ```cpp
   cudaMemcpy(d_a, h_a, n*sizeof(float), cudaMemcpyHostToDevice);
   ```

   –ò–Ω–æ–≥–¥–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–Ω–∏–º–∞–µ—Ç **–±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏, —á–µ–º –≤—ã—á–∏—Å–ª–µ–Ω–∏—è**.

3. **–ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ shared memory**

   ```cpp
   extern __shared__ float s[]; // –Ω–µ–ª—å–∑—è –±–æ–ª—å—à–µ –ª–∏–º–∏—Ç–∞
   ```

4. **–§—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –Ω–µ—Ö–≤–∞—Ç–∫–∞ –ø–∞–º—è—Ç–∏**
   –ß–∞—Å—Ç—ã–µ `cudaMalloc` / `cudaFree` –∑–∞–º–µ–¥–ª—è—é—Ç –ø—Ä–æ–≥—Ä–∞–º–º—É.

---

### üîπ –†–µ–∞–ª—å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

| –ü—Ä–æ–±–ª–µ–º–∞               | –†–µ—à–µ–Ω–∏–µ                        |
| ---------------------- | ------------------------------ |
| –ù–µ –ø–æ–º–µ—â–∞–µ—Ç—Å—è –≤ –ø–∞–º—è—Ç—å | –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å **–±–∞—Ç—á–∞–º–∏**       |
| –ú–µ–¥–ª–µ–Ω–Ω—ã–π memcpy       | –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **pinned memory** |
| –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç shared      | fallback –Ω–∞ global             |
| –ú–Ω–æ–≥–æ malloc           | –≤—ã–¥–µ–ª—è—Ç—å –ø–∞–º—è—Ç—å **–æ–¥–∏–Ω —Ä–∞–∑**   |

–ü—Ä–∏–º–µ—Ä fallback (–∫–∞–∫ –≤ —Ç–≤–æ–µ–π –∑–∞–¥–∞—á–µ 4):

```cpp
if (sh <= shared_limit)
    merge_pass_shared<<<...>>>();
else
    merge_pass_global<<<...>>>();
```

---

# 5. –ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ global memory?

Global memory:

* –∑–∞–¥–µ—Ä–∂–∫–∞ ~**400‚Äì800 —Ç–∞–∫—Ç–æ–≤**
* register/shared ‚Äî **1‚Äì5 —Ç–∞–∫—Ç–æ–≤**

### üîπ –ü—Ä–∏–º–µ—Ä: —É–º–Ω–æ–∂–µ–Ω–∏–µ –≤–µ–∫—Ç–æ—Ä–∞

‚ùå –ü–ª–æ—Ö–æ:

```cpp
for (...) 
    c[i] = a[i] * b[i];   // –∫–∞–∂–¥—ã–π —Ä–∞–∑ –∏–∑ global
```

‚úÖ –õ—É—á—à–µ:

```cpp
float x = a[i];  // –æ–¥–∏–Ω —Ä–∞–∑
float y = b[i];
c[i] = x * y;
```

### üîπ –ï—â—ë –ª—É—á—à–µ ‚Äî —á–µ—Ä–µ–∑ shared

```cpp
__shared__ float sa[256], sb[256];
sa[tid] = a[i];
sb[tid] = b[i];
__syncthreads();
c[i] = sa[tid] * sb[tid];
```

üëâ –¢—ã:

* —É–º–µ–Ω—å—à–∏–ª –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ global
* —É–≤–µ–ª–∏—á–∏–ª **–∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫—É—é –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å**
* –ø–æ–ª—É—á–∏–ª **—É—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ 2‚Äì5 —Ä–∞–∑**

---

# 6. –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏?

–ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:

* –≥–¥–µ –ø—Ä–æ–≥—Ä–∞–º–º–∞ **—Ç–µ—Ä—è–µ—Ç –≤—Ä–µ–º—è**
* –∫–∞–∫–∏–µ —è–¥—Ä–∞ **–º–µ–¥–ª–µ–Ω–Ω—ã–µ**
* —Å–∫–æ–ª—å–∫–æ –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ –ø–∞–º—è—Ç–∏
* occupancy, warps, stalls

---

## üîπ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

### 1. **Nsight Systems**

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:

* timeline CPU + GPU
* memcpy
* kernel launches

### 2. **Nsight Compute**

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:

* global load efficiency
* shared memory usage
* warp divergence
* occupancy

---

## üîπ –ü—Ä–∏–º–µ—Ä –∞–Ω–∞–ª–∏–∑–∞

–¢—ã –∑–∞–ø—É—Å–∫–∞–µ—à—å —Ä–µ–¥—É–∫—Ü–∏—é –∏ –≤–∏–¥–∏—à—å:

| –ú–µ—Ç—Ä–∏–∫–∞                    | –ó–Ω–∞—á–µ–Ω–∏–µ  |
| -------------------------- | --------- |
| Global memory transactions | 1,200,000 |
| Shared memory transactions | 20,000    |
| Occupancy                  | 45%       |

–ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

| –ú–µ—Ç—Ä–∏–∫–∞                    | –ó–Ω–∞—á–µ–Ω–∏–µ    |
| -------------------------- | ----------- |
| Global memory transactions | **150,000** |
| Shared memory transactions | 25,000      |
| Occupancy                  | **85%**     |

üëâ –ó–Ω–∞—á–∏—Ç:

* —Ç—ã **–ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ã–Ω–µ—Å** –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤ shared
* GPU –∑–∞–≥—Ä—É–∂–µ–Ω —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ
* latency —Å–∫—Ä—ã—Ç–∞ –ª—É—á—à–µ

---

# üîö –ö–æ—Ä–æ—Ç–∫–∏–π –∏—Ç–æ–≥

| –í–æ–ø—Ä–æ—Å         | –ì–ª–∞–≤–Ω–æ–µ                      |
| -------------- | ---------------------------- |
| –¢–∏–ø—ã –ø–∞–º—è—Ç–∏    | –≤—ã–±–∏—Ä–∞–π –ø–æ —á–∞—Å—Ç–æ—Ç–µ –¥–æ—Å—Ç—É–ø–∞   |
| Shared memory  | —É–º–µ–Ω—å—à–∞–µ—Ç –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ global |
| –ö–æ–∞–ª–µ—Å—Ü–µ–Ω—Ü–∏—è   | –ø–æ—Ç–æ–∫–∏ —á–∏—Ç–∞—é—Ç –ø–æ–¥—Ä—è–¥         |
| –ë–æ–ª—å—à–∏–µ –¥–∞–Ω–Ω—ã–µ | –±–∞—Ç—á–∏, pinned memory         |
| Global memory  | –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø        |
| –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ | Nsight = —Ç–≤–æ–π –ª—É—á—à–∏–π –¥—Ä—É–≥    |



