// task_1_openmp_array.cpp                                   // имя файла
// Задание 1: Обработка массива на CPU с использованием OpenMP // описание задания
// Операция: умножение каждого элемента массива на 2           // что делаем с массивом
// Размер массива: N = 1 000 000                               // размер массива
// Замер времени выполнения                                    // измеряем время

#include <iostream>                                           // библиотека для ввода/вывода (cout)
#include <vector>                                             // библиотека для std::vector
#include <chrono>                                             // библиотека для измерения времени
#include <omp.h>                                              // библиотека OpenMP

int main() {                                                  // точка входа в программу
    const int N = 1'000'000;                                  // задаем размер массива N
    std::vector<float> A(N);                                  // создаем массив A из N элементов типа float

    // ----------------- Инициализация массива ----------------- // заголовок блока инициализации
    for (int i = 0; i < N; ++i) {                             // цикл по всем элементам массива
        A[i] = static_cast<float>(i);                         // записываем в A[i] значение i, приводим к float
    }                                                         // конец цикла инициализации

    // ----------------- Обработка массива с OpenMP ----------------- // заголовок блока обработки
    auto start = std::chrono::high_resolution_clock::now();   // фиксируем время начала вычислений

    #pragma omp parallel for                                  // директива OpenMP: распараллелить цикл for
    for (int i = 0; i < N; ++i) {                             // параллельный цикл по всем элементам массива
        A[i] *= 2.0f;   // обработка элемента массива         // умножаем текущий элемент на 2
    }                                                         // конец параллельного цикла

    auto end = std::chrono::high_resolution_clock::now();     // фиксируем время окончания вычислений

    // ----------------- Подсчет времени -----------------       // заголовок блока подсчета времени
    std::chrono::duration<double, std::milli> elapsed = end - start; // вычисляем длительность выполнения в миллисекундах

    std::cout << "=== OpenMP array processing ===\n";         // выводим заголовок программы
    std::cout << "N: " << N << "\n";                          // выводим размер массива N
    std::cout << "Threads used: " << omp_get_max_threads() << "\n"; // выводим максимальное число потоков OpenMP
    std::cout << "Time (ms): " << elapsed.count() << "\n";    // выводим измеренное время в миллисекундах

    // Проверка (чтобы убедиться, что реально умножилось)        // комментарий о проверке результата
    std::cout << "Check: A[0] = " << A[0] << ", A[N-1] = " << A[N-1] << "\n"; // выводим 1-й и последний элемент для проверки

    return 0;                                                 // успешное завершение программы
}                                                             // конец функции main
